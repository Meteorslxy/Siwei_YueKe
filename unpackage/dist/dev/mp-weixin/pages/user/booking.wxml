<view class="booking-container"><view class="tab-bar"><block wx:for="{{$root.l0}}" wx:for-item="tab" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['changeTab',['$0'],[[['tabs','',index,'value']]]]]]]}}" class="{{['tab-item',(currentStatus===tab.$orig.value)?'active':'']}}" bindtap="__e">{{''+tab.$orig.label+''}}<block wx:if="{{tab.m0>0}}"><view class="badge">{{tab.m1}}</view></block></view></block></view><view class="booking-list"><block wx:for="{{$root.l1}}" wx:for-item="item" wx:for-index="index"><view class="booking-item" data-booking-id="{{item.$orig._id}}" data-course-id="{{item.$orig.courseId}}" data-event-opts="{{[['tap',[['viewDetail',['$0','$event'],[[['filteredBookingList','_id||index',item.$orig._id||index]]]]]]]}}" bindtap="__e"><view class="course-title-container"><view class="course-title">{{item.$orig.courseTitle||item.$orig.title}}</view></view><view class="booking-content"><view class="booking-left"><view class="booking-status-wrapper"><view class="{{['booking-status','status-'+item.$orig.status]}}">{{item.m2}}</view><block wx:if="{{item.$orig.isCourseDeleted}}"><view class="status-tag">课程已删除</view></block><block wx:if="{{item.m3}}"><view class="status-tag auto-cancel">超时未支付自动取消</view></block></view><block wx:if="{{item.m4}}"><view class="payment-countdown"><text class="countdown-label">支付倒计时：</text><text class="countdown-time">{{item.m5}}</text></view></block><block wx:if="{{item.$orig.paymentStatus==='paid'||item.$orig.isPaid===true}}"><view class="payment-time"><text class="payment-time-label">支付时间：</text><text class="payment-time-value">{{item.m6}}</text></view></block><view class="booking-time">{{'预约时间：'+item.m7+''}}</view></view><view class="booking-right"><view class="detail-info"><view class="detail-row"><text class="detail-label">校区地点</text><text class="detail-value">{{item.$orig.schoolName||'未知'}}</text></view><view class="detail-row"><text class="detail-label">课程时间</text><text class="detail-value">{{item.m8}}</text></view><view class="detail-row"><text class="detail-label">课程日期</text><text class="detail-value">{{item.m9}}</text></view><view class="detail-row"><text class="detail-label">学生姓名</text><text class="detail-value">{{item.$orig.studentName}}</text></view><block wx:if="{{item.$orig.teacherName}}"><view class="detail-row"><text class="detail-label">任课教师</text><text class="detail-value teacher-name">{{item.$orig.teacherName}}</text></view></block></view></view></view><block wx:if="{{item.m10}}"><view class="booking-actions"><block wx:if="{{item.$orig&&item.$orig.status!=='cancelled'&&item.$orig.status!=='finished'}}"><view data-event-opts="{{[['tap',[['e0',['$event']]]]]}}" data-event-params="{{({item:item.$orig})}}" class="action-btn cancel-btn" catchtap="__e">{{''+(item.$orig.paymentStatus==='paid'||item.$orig.isPaid===true?'转班申请':'取消预约')+''}}</view></block><block wx:if="{{item.m11}}"><view data-event-opts="{{[['tap',[['e1',['$event']]]]]}}" data-event-params="{{({item:item.$orig})}}" class="action-btn pay-btn" catchtap="__e">去缴费</view></block><block wx:if="{{item.m12}}"><view data-event-opts="{{[['tap',[['e2',['$event']]]]]}}" data-event-params="{{({item:item.$orig})}}" class="action-btn contact-btn" catchtap="__e">联系老师</view></block><block wx:if="{{(item.$orig.paymentStatus==='paid'||item.$orig.isPaid===true)&&item.$orig.status!=='cancelled'&&item.$orig.status!=='cancel'&&item.$orig.paymentStatus!=='refunded'}}"><view data-event-opts="{{[['tap',[['e3',['$event']]]]]}}" data-event-params="{{({item:item.$orig})}}" class="action-btn refund-btn" catchtap="__e">申请退费</view></block></view></block></view></block><block wx:if="{{$root.g0===0}}"><empty-tip vue-id="5bb75a38-1" tip="{{$root.m13}}" bind:__l="__l"></empty-tip></block><block wx:if="{{loadMoreStatus!=='noMore'}}"><uni-load-more vue-id="5bb75a38-2" status="{{loadMoreStatus}}" bind:__l="__l"></uni-load-more></block></view><uni-popup class="vue-ref" vue-id="5bb75a38-3" type="center" data-ref="qrcodePopup" bind:__l="__l" vue-slots="{{['default']}}"><view class="qrcode-popup"><view class="qrcode-title">{{isRefunding?'扫码退费':'扫码缴费'}}</view><image class="qrcode-image" src="{{qrcodeUrl}}" mode="aspectFit"></image><view class="qrcode-contact"><text>如有问题，请联系老师</text><text>电话：13800138000</text></view><button data-event-opts="{{[['tap',[['closeQrcodePopup',['$event']]]]]}}" class="close-btn" bindtap="__e">关闭</button></view></uni-popup></view>
(global["webpackJsonp"] = global["webpackJsonp"] || []).push([["pages/cart/index"],{

/***/ 120:
/*!*******************************************************************************************************************!*\
  !*** C:/Users/liuxingyu/Desktop/TurboTrainning-main/yueke/Siwei_chuzhong/main.js?{"page":"pages%2Fcart%2Findex"} ***!
  \*******************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(wx, createPage) {

var _interopRequireDefault = __webpack_require__(/*! @babel/runtime/helpers/interopRequireDefault */ 4);
__webpack_require__(/*! uni-pages */ 38);
__webpack_require__(/*! @dcloudio/vue-cli-plugin-uni/packages/uni-cloud/dist/index.js */ 26);
var _vue = _interopRequireDefault(__webpack_require__(/*! vue */ 25));
var _index2 = _interopRequireDefault(__webpack_require__(/*! ./pages/cart/index.vue */ 121));
// @ts-ignore
wx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;
createPage(_index2.default);
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./node_modules/@dcloudio/uni-mp-weixin/dist/wx.js */ 1)["default"], __webpack_require__(/*! ./node_modules/@dcloudio/uni-mp-weixin/dist/index.js */ 2)["createPage"]))

/***/ }),

/***/ 121:
/*!************************************************************************************************!*\
  !*** C:/Users/liuxingyu/Desktop/TurboTrainning-main/yueke/Siwei_chuzhong/pages/cart/index.vue ***!
  \************************************************************************************************/
/*! no static exports found */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _index_vue_vue_type_template_id_457cfe48___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index.vue?vue&type=template&id=457cfe48& */ 122);
/* harmony import */ var _index_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./index.vue?vue&type=script&lang=js& */ 124);
/* harmony reexport (unknown) */ for(var __WEBPACK_IMPORT_KEY__ in _index_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__) if(["default"].indexOf(__WEBPACK_IMPORT_KEY__) < 0) (function(key) { __webpack_require__.d(__webpack_exports__, key, function() { return _index_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__[key]; }) }(__WEBPACK_IMPORT_KEY__));
/* harmony import */ var _index_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index.vue?vue&type=style&index=0&lang=scss& */ 127);
/* harmony import */ var _D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js */ 44);

var renderjs





/* normalize component */

var component = Object(_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_3__["default"])(
  _index_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__["default"],
  _index_vue_vue_type_template_id_457cfe48___WEBPACK_IMPORTED_MODULE_0__["render"],
  _index_vue_vue_type_template_id_457cfe48___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"],
  false,
  null,
  null,
  null,
  false,
  _index_vue_vue_type_template_id_457cfe48___WEBPACK_IMPORTED_MODULE_0__["components"],
  renderjs
)

component.options.__file = "pages/cart/index.vue"
/* harmony default export */ __webpack_exports__["default"] = (component.exports);

/***/ }),

/***/ 122:
/*!*******************************************************************************************************************************!*\
  !*** C:/Users/liuxingyu/Desktop/TurboTrainning-main/yueke/Siwei_chuzhong/pages/cart/index.vue?vue&type=template&id=457cfe48& ***!
  \*******************************************************************************************************************************/
/*! exports provided: render, staticRenderFns, recyclableRender, components */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_17_0_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_template_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_uni_app_loader_page_meta_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_template_id_457cfe48___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--17-0!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=template&id=457cfe48& */ 123);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "render", function() { return _D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_17_0_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_template_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_uni_app_loader_page_meta_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_template_id_457cfe48___WEBPACK_IMPORTED_MODULE_0__["render"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return _D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_17_0_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_template_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_uni_app_loader_page_meta_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_template_id_457cfe48___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "recyclableRender", function() { return _D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_17_0_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_template_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_uni_app_loader_page_meta_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_template_id_457cfe48___WEBPACK_IMPORTED_MODULE_0__["recyclableRender"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "components", function() { return _D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_17_0_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_template_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_uni_app_loader_page_meta_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_template_id_457cfe48___WEBPACK_IMPORTED_MODULE_0__["components"]; });



/***/ }),

/***/ 123:
/*!*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--17-0!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!C:/Users/liuxingyu/Desktop/TurboTrainning-main/yueke/Siwei_chuzhong/pages/cart/index.vue?vue&type=template&id=457cfe48& ***!
  \*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns, recyclableRender, components */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "render", function() { return render; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return staticRenderFns; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "recyclableRender", function() { return recyclableRender; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "components", function() { return components; });
var components
try {
  components = {
    emptyTip: function () {
      return __webpack_require__.e(/*! import() | components/empty-tip/empty-tip */ "components/empty-tip/empty-tip").then(__webpack_require__.bind(null, /*! @/components/empty-tip/empty-tip.vue */ 48))
    },
    loadMore: function () {
      return __webpack_require__.e(/*! import() | components/load-more/load-more */ "components/load-more/load-more").then(__webpack_require__.bind(null, /*! @/components/load-more/load-more.vue */ 55))
    },
  }
} catch (e) {
  if (
    e.message.indexOf("Cannot find module") !== -1 &&
    e.message.indexOf(".vue") !== -1
  ) {
    console.error(e.message)
    console.error("1. 排查组件名称拼写是否正确")
    console.error(
      "2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"
    )
    console.error(
      "3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件"
    )
  } else {
    throw e
  }
}
var render = function () {
  var _vm = this
  var _h = _vm.$createElement
  var _c = _vm._self._c || _h
  var g0 = _vm.favoriteList.length
  var l0 =
    g0 > 0
      ? _vm.__map(_vm.favoriteList, function (item, index) {
          var $orig = _vm.__get_orig(item)
          var m0 = item.itemCover || _vm.getDefaultImage(item.itemType)
          var m1 = _vm.getItemTypeName(item.itemType)
          var m2 = _vm.formatDate(item.createTime)
          return {
            $orig: $orig,
            m0: m0,
            m1: m1,
            m2: m2,
          }
        })
      : null
  var g1 = _vm.favoriteList.length
  _vm.$mp.data = Object.assign(
    {},
    {
      $root: {
        g0: g0,
        l0: l0,
        g1: g1,
      },
    }
  )
}
var recyclableRender = false
var staticRenderFns = []
render._withStripped = true



/***/ }),

/***/ 124:
/*!*************************************************************************************************************************!*\
  !*** C:/Users/liuxingyu/Desktop/TurboTrainning-main/yueke/Siwei_chuzhong/pages/cart/index.vue?vue&type=script&lang=js& ***!
  \*************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_13_1_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!./node_modules/babel-loader/lib!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--13-1!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js& */ 125);
/* harmony import */ var _D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_13_1_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_13_1_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__);
/* harmony reexport (unknown) */ for(var __WEBPACK_IMPORT_KEY__ in _D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_13_1_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__) if(["default"].indexOf(__WEBPACK_IMPORT_KEY__) < 0) (function(key) { __webpack_require__.d(__webpack_exports__, key, function() { return _D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_13_1_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__[key]; }) }(__WEBPACK_IMPORT_KEY__));
 /* harmony default export */ __webpack_exports__["default"] = (_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_13_1_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0___default.a); 

/***/ }),

/***/ 125:
/*!********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/babel-loader/lib!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--13-1!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!C:/Users/liuxingyu/Desktop/TurboTrainning-main/yueke/Siwei_chuzhong/pages/cart/index.vue?vue&type=script&lang=js& ***!
  \********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(uni, uniCloud) {

var _interopRequireDefault = __webpack_require__(/*! @babel/runtime/helpers/interopRequireDefault */ 4);
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _regenerator = _interopRequireDefault(__webpack_require__(/*! @babel/runtime/regenerator */ 27));
var _toConsumableArray2 = _interopRequireDefault(__webpack_require__(/*! @babel/runtime/helpers/toConsumableArray */ 18));
var _defineProperty2 = _interopRequireDefault(__webpack_require__(/*! @babel/runtime/helpers/defineProperty */ 11));
var _asyncToGenerator2 = _interopRequireDefault(__webpack_require__(/*! @babel/runtime/helpers/asyncToGenerator */ 30));
function _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it.return != null) it.return(); } finally { if (didErr) throw err; } } }; }
function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }
function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }
function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
var _default = {
  data: function data() {
    return {
      tabs: [{
        name: '全部',
        type: 'all'
      }, {
        name: '课程',
        type: 'course'
      }, {
        name: '讲座',
        type: 'lecture'
      }, {
        name: '教师',
        type: 'teacher'
      }],
      currentTab: 0,
      favoriteList: [],
      page: 1,
      pageSize: 10,
      loading: false,
      loadMoreStatus: 'more',
      hasMore: true,
      isManageMode: false,
      // 是否为管理模式
      isAllSelected: false,
      // 是否全选
      currentBookingCourseId: null,
      currentSelectedCourseIds: [],
      userInfo: null,
      // 添加用户信息
      rightOptions: [{
        text: '删除',
        style: {
          backgroundColor: '#FF3B30'
        }
      }],
      startX: 0,
      // 记录触摸开始的X坐标
      startY: 0 // 记录触摸开始的Y坐标
    };
  },

  computed: {
    // 选中的数量
    selectedCount: function selectedCount() {
      return this.favoriteList.filter(function (item) {
        return item.selected;
      }).length;
    },
    // 计算总价
    totalPrice: function totalPrice() {
      return this.favoriteList.filter(function (item) {
        return item.selected;
      }).reduce(function (sum, item) {
        // 确保价格是有效的数字
        var price = parseFloat(item.price) || 0;
        console.log("\u9009\u4E2D\u9879\u76EE ".concat(item.itemTitle, " \u4EF7\u683C: ").concat(price));
        return sum + price;
      }, 0);
    }
  },
  onLoad: function onLoad() {
    // 获取用户信息
    this.getUserInfo();
    // 清除课程缓存
    try {
      console.log('清除课程缓存');
      uni.getStorageInfo({
        success: function success(res) {
          var keys = res.keys;
          keys.forEach(function (key) {
            if (key.startsWith('course_')) {
              uni.removeStorageSync(key);
              console.log("\u5DF2\u5220\u9664\u7F13\u5B58: ".concat(key));
            }
          });
        }
      });
    } catch (e) {
      console.error('清除缓存失败:', e);
    }
    // 获取收藏列表
    this.getFavoriteList();
  },
  onPullDownRefresh: function onPullDownRefresh() {
    this.refreshList();
  },
  methods: {
    // 切换标签
    switchTab: function switchTab(index) {
      if (this.currentTab === index) return;
      this.currentTab = index;
      this.refreshList();
    },
    // 触摸开始事件
    touchStart: function touchStart(index, event) {
      this.startX = event.touches[0].clientX;
      this.startY = event.touches[0].clientY;
    },
    // 触摸移动事件
    touchMove: function touchMove(index, event) {
      var moveX = event.touches[0].clientX;
      var moveY = event.touches[0].clientY;

      // 计算X和Y方向的移动距离
      var deltaX = this.startX - moveX;
      var deltaY = this.startY - moveY;

      // 如果Y方向移动大于X方向，则认为是上下滑动，不处理
      if (Math.abs(deltaY) > Math.abs(deltaX)) {
        return;
      }

      // 左滑显示删除按钮
      if (deltaX > 50) {
        // 防止在滑动过程中频繁更新视图
        if (!this.favoriteList[index].swipeActive) {
          this.$set(this.favoriteList[index], 'swipeActive', true);
        }
      } else if (deltaX < -50) {
        // 右滑隐藏删除按钮
        if (this.favoriteList[index].swipeActive) {
          this.$set(this.favoriteList[index], 'swipeActive', false);
        }
      }
    },
    // 触摸结束事件
    touchEnd: function touchEnd(index) {
      // 记录最后的滑动状态即可，无需额外操作
    },
    // 刷新列表
    refreshList: function refreshList() {
      this.page = 1;
      this.hasMore = true;
      this.loadMoreStatus = 'more';
      this.favoriteList = [];
      this.getFavoriteList();
    },
    // 获取收藏列表
    getFavoriteList: function getFavoriteList() {
      var _this = this;
      return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee() {
        var userId, params, res, list, processedList;
        return _regenerator.default.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                if (!_this.loading) {
                  _context.next = 2;
                  break;
                }
                return _context.abrupt("return");
              case 2:
                _this.loading = true;
                _this.loadMoreStatus = 'loading';
                _context.prev = 4;
                // 确保有有效的用户信息
                if (!_this.userInfo) {
                  _this.getUserInfo();
                }
                if (_this.userInfo) {
                  _context.next = 11;
                  break;
                }
                _this.loading = false;
                _this.loadMoreStatus = 'more';
                uni.showToast({
                  title: '请先登录',
                  icon: 'none'
                });
                return _context.abrupt("return");
              case 11:
                // 获取用户ID，支持多种字段格式
                userId = _this.userInfo.userId || _this.userInfo._id || _this.userInfo.uid || _this.userInfo.userInfo && _this.userInfo.userInfo._id || _this.userInfo.userInfo && _this.userInfo.userInfo.uid || ''; // 检查用户ID
                if (userId) {
                  _context.next = 18;
                  break;
                }
                console.error('获取收藏列表失败: 无法获取用户ID', _this.userInfo);
                _this.loading = false;
                _this.loadMoreStatus = 'more';
                uni.showToast({
                  title: '用户信息不完整，请重新登录',
                  icon: 'none'
                });
                return _context.abrupt("return");
              case 18:
                // 构建请求参数
                params = {
                  userId: userId,
                  page: _this.page,
                  pageSize: _this.pageSize,
                  type: _this.tabs[_this.currentTab].type
                };
                console.log('获取收藏列表，参数:', params);
                uni.showLoading({
                  title: '加载中'
                });
                _context.next = 23;
                return _this.$api.user.getFavoriteList(params);
              case 23:
                res = _context.sent;
                if (res && res.code === 0) {
                  list = res.data || []; // 确保列表项都有必要的属性
                  processedList = list.map(function (item) {
                    // 处理可能的数据结构问题
                    var processedItem = _objectSpread(_objectSpread({}, item), {}, {
                      selected: false
                    });

                    // 如果缺少必要的属性，添加默认值
                    if (!processedItem.itemType) {
                      console.warn('收藏项缺少itemType:', item);
                      processedItem.itemType = 'unknown';
                    }

                    // 确保itemId存在
                    if (!processedItem.itemId && processedItem.itemUrl) {
                      // 尝试从URL提取ID
                      var match = processedItem.itemUrl.match(/id=([^&]+)/);
                      if (match && match[1]) {
                        processedItem.itemId = match[1];
                      }
                    }

                    // 确保图片地址有效
                    if (!processedItem.itemCover) {
                      processedItem.itemCover = _this.getDefaultImage(processedItem.itemType);
                    }
                    return processedItem;
                  });
                  if (_this.page === 1) {
                    _this.favoriteList = processedList;
                  } else {
                    _this.favoriteList = [].concat((0, _toConsumableArray2.default)(_this.favoriteList), (0, _toConsumableArray2.default)(processedList));
                  }

                  // 对所有课程类型的商品立即获取最新价格信息
                  _this.favoriteList.forEach(function (item) {
                    if (item.itemType === 'course' && item.itemId) {
                      _this.fetchCoursePrice(item);
                    }
                  });
                  _this.hasMore = list.length === _this.pageSize;
                  _this.loadMoreStatus = _this.hasMore ? 'more' : 'noMore';
                } else {
                  uni.showToast({
                    title: '获取购物车列表失败',
                    icon: 'none'
                  });
                }
                _context.next = 31;
                break;
              case 27:
                _context.prev = 27;
                _context.t0 = _context["catch"](4);
                console.error('获取购物车列表失败:', _context.t0);
                uni.showToast({
                  title: '获取购物车列表失败',
                  icon: 'none'
                });
              case 31:
                _context.prev = 31;
                _this.loading = false;
                uni.hideLoading();
                uni.stopPullDownRefresh();
                return _context.finish(31);
              case 36:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, null, [[4, 27, 31, 36]]);
      }))();
    },
    // 获取课程价格信息
    fetchCoursePrice: function fetchCoursePrice(item) {
      var _arguments = arguments,
        _this2 = this;
      return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee2() {
        var retryCount, res, course, classFee, materialFee, finalPrice;
        return _regenerator.default.wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                retryCount = _arguments.length > 1 && _arguments[1] !== undefined ? _arguments[1] : 0;
                _context2.prev = 1;
                console.log("\u5F00\u59CB\u83B7\u53D6\u8BFE\u7A0B".concat(item.itemId, "\u7684\u4EF7\u683C\u4FE1\u606F\uFF0C\u7ED5\u8FC7\u7F13\u5B58").concat(retryCount > 0 ? ' (重试次数: ' + retryCount + ')' : ''));

                // 直接调用云函数获取最新课程价格，不使用API缓存
                _context2.next = 5;
                return uniCloud.callFunction({
                  name: 'getCourseDetail',
                  data: {
                    courseId: item.itemId
                  }
                });
              case 5:
                res = _context2.sent;
                console.log("\u76F4\u63A5\u83B7\u53D6\u8BFE\u7A0B\u4EF7\u683C\u7ED3\u679C:", res.result);
                if (res.result && res.result.success && res.result.data) {
                  course = res.result.data; // 处理可能返回的数组格式
                  if (Array.isArray(course)) {
                    course = course[0];
                  }

                  // 输出课程的完整属性，帮助调试
                  console.log("\u8BFE\u7A0B\u5B8C\u6574\u4FE1\u606F:", JSON.stringify({
                    id: course._id,
                    title: course.title,
                    classFee: course.classFee,
                    materialFee: course.materialFee,
                    price: course.price,
                    totalFee: course.totalFee,
                    fee: course.fee,
                    courseFee: course.courseFee,
                    discountPrice: course.discountPrice,
                    originalPrice: course.originalPrice
                  }));

                  // 获取价格信息，优先使用课时费和材料费
                  classFee = parseFloat(course.classFee || 0);
                  materialFee = parseFloat(course.materialFee || 0); // 计算总价：课时费和材料费的总和
                  finalPrice = classFee + materialFee;
                  console.log("\u8BFE\u65F6\u8D39: ".concat(classFee, ", \u6750\u6599\u8D39: ").concat(materialFee, ", \u603B\u4EF7: ").concat(finalPrice));

                  // 如果课时费和材料费都为0，尝试使用其他价格字段
                  if (finalPrice === 0) {
                    finalPrice = parseFloat(course.price || 0);
                    console.log("\u4F7F\u7528\u8BFE\u7A0B\u539F\u4EF7: ".concat(finalPrice));
                  }

                  // 如果还是0，尝试其他可能的价格字段
                  if (finalPrice === 0 && course.totalFee) {
                    finalPrice = parseFloat(course.totalFee || 0);
                    console.log("\u4F7F\u7528\u603B\u8D39\u7528: ".concat(finalPrice));
                  }
                  if (finalPrice === 0 && course.fee) {
                    finalPrice = parseFloat(course.fee || 0);
                    console.log("\u4F7F\u7528\u8D39\u7528: ".concat(finalPrice));
                  }
                  if (finalPrice === 0 && course.courseFee) {
                    finalPrice = parseFloat(course.courseFee || 0);
                    console.log("\u4F7F\u7528\u8BFE\u7A0B\u8D39\u7528: ".concat(finalPrice));
                  }
                  if (finalPrice === 0 && course.discountPrice) {
                    finalPrice = parseFloat(course.discountPrice || 0);
                    console.log("\u4F7F\u7528\u6298\u6263\u4EF7: ".concat(finalPrice));
                  } else if (finalPrice === 0 && course.originalPrice) {
                    finalPrice = parseFloat(course.originalPrice || 0);
                    console.log("\u4F7F\u7528\u539F\u4EF7: ".concat(finalPrice));
                  }

                  // 设置最终价格，确保为数字
                  item.price = finalPrice;
                  console.log("\u66F4\u65B0\u8BFE\u7A0B ".concat(item.itemTitle, " \u4EF7\u683C\u4E3A: ").concat(item.price));

                  // 如果价格为0，并且重试次数小于3，则延迟2秒后重试
                  if (item.price === 0 && retryCount < 3) {
                    console.log("\u8BFE\u7A0B\u4EF7\u683C\u4E3A0\uFF0C\u5C06\u57282\u79D2\u540E\u91CD\u8BD5, \u5F53\u524D\u91CD\u8BD5\u6B21\u6570: ".concat(retryCount));
                    setTimeout(function () {
                      _this2.fetchCoursePrice(item, retryCount + 1);
                    }, 2000);
                  }

                  // 强制更新视图
                  _this2.$forceUpdate();
                } else {
                  console.error('获取课程价格失败, 返回结果:', res.result);

                  // 如果获取失败且重试次数小于3，则延迟2秒后重试
                  if (retryCount < 3) {
                    console.log("\u83B7\u53D6\u5931\u8D25\uFF0C\u5C06\u57282\u79D2\u540E\u91CD\u8BD5, \u5F53\u524D\u91CD\u8BD5\u6B21\u6570: ".concat(retryCount));
                    setTimeout(function () {
                      _this2.fetchCoursePrice(item, retryCount + 1);
                    }, 2000);
                  }
                }
                _context2.next = 14;
                break;
              case 10:
                _context2.prev = 10;
                _context2.t0 = _context2["catch"](1);
                console.error('获取课程价格失败:', _context2.t0);

                // 如果发生异常且重试次数小于3，则延迟2秒后重试
                if (retryCount < 3) {
                  console.log("\u53D1\u751F\u5F02\u5E38\uFF0C\u5C06\u57282\u79D2\u540E\u91CD\u8BD5, \u5F53\u524D\u91CD\u8BD5\u6B21\u6570: ".concat(retryCount));
                  setTimeout(function () {
                    _this2.fetchCoursePrice(item, retryCount + 1);
                  }, 2000);
                }
              case 14:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, null, [[1, 10]]);
      }))();
    },
    // 切换管理模式
    toggleManageMode: function toggleManageMode() {
      this.isManageMode = !this.isManageMode;
    },
    // 切换选择状态
    toggleSelect: function toggleSelect(index) {
      this.favoriteList[index].selected = !this.favoriteList[index].selected;
      // 检查是否全选
      this.checkAllSelected();
    },
    // 切换全选状态
    toggleSelectAll: function toggleSelectAll() {
      var _this3 = this;
      this.isAllSelected = !this.isAllSelected;
      this.favoriteList.forEach(function (item) {
        item.selected = _this3.isAllSelected;
      });
    },
    // 检查是否全选
    checkAllSelected: function checkAllSelected() {
      this.isAllSelected = this.favoriteList.length > 0 && this.favoriteList.every(function (item) {
        return item.selected;
      });
    },
    // 获取用户信息
    getUserInfo: function getUserInfo() {
      try {
        var userInfoStr = uni.getStorageSync('userInfo');
        if (userInfoStr) {
          this.userInfo = typeof userInfoStr === 'string' ? JSON.parse(userInfoStr) : userInfoStr;
        }
      } catch (error) {
        console.error('获取用户信息失败:', error);
      }
    },
    // 立即预约单个课程
    bookCourse: function bookCourse(item) {
      var _this4 = this;
      return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee3() {
        return _regenerator.default.wrap(function _callee3$(_context3) {
          while (1) {
            switch (_context3.prev = _context3.next) {
              case 0:
                if (!(item.itemType !== 'course')) {
                  _context3.next = 3;
                  break;
                }
                uni.showToast({
                  title: '只能预约课程',
                  icon: 'none'
                });
                return _context3.abrupt("return");
              case 3:
                // 存储当前预约的课程ID，用于预约成功后删除
                _this4.currentBookingCourseId = item._id;

                // 直接预约课程，不再跳转
                _context3.next = 6;
                return _this4.submitBooking(item.itemId);
              case 6:
              case "end":
                return _context3.stop();
            }
          }
        }, _callee3);
      }))();
    },
    // 一键预约或批量删除
    checkout: function checkout() {
      if (this.selectedCount === 0) {
        uni.showToast({
          title: '请先选择课程',
          icon: 'none'
        });
        return;
      }
      if (this.isManageMode) {
        // 批量删除
        this.batchDelete();
      } else {
        // 批量预约
        this.batchBook();
      }
    },
    // 批量预约
    batchBook: function batchBook() {
      var _this5 = this;
      return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee4() {
        var selectedCourses, successCount, failCount, _iterator, _step, course, result, message;
        return _regenerator.default.wrap(function _callee4$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                selectedCourses = _this5.favoriteList.filter(function (item) {
                  return item.selected && item.itemType === 'course';
                });
                if (!(selectedCourses.length === 0)) {
                  _context4.next = 4;
                  break;
                }
                uni.showToast({
                  title: '请选择课程进行预约',
                  icon: 'none'
                });
                return _context4.abrupt("return");
              case 4:
                // 存储当前选中的所有课程ID，用于预约成功后删除
                _this5.currentSelectedCourseIds = selectedCourses.map(function (item) {
                  return item._id;
                });

                // 依次预约所有选中的课程
                successCount = 0;
                failCount = 0;
                uni.showLoading({
                  title: '批量预约中...'
                });

                // 依次处理每个课程
                _iterator = _createForOfIteratorHelper(selectedCourses);
                _context4.prev = 9;
                _iterator.s();
              case 11:
                if ((_step = _iterator.n()).done) {
                  _context4.next = 32;
                  break;
                }
                course = _step.value;
                _context4.prev = 13;
                _context4.next = 16;
                return _this5.submitBooking(course.itemId, false);
              case 16:
                result = _context4.sent;
                if (!(result && result.success)) {
                  _context4.next = 23;
                  break;
                }
                successCount++;
                // 预约成功后从购物车移除
                _context4.next = 21;
                return _this5.removeFromCartAfterBooking(course._id, false);
              case 21:
                _context4.next = 24;
                break;
              case 23:
                failCount++;
              case 24:
                _context4.next = 30;
                break;
              case 26:
                _context4.prev = 26;
                _context4.t0 = _context4["catch"](13);
                console.error('预约课程失败:', _context4.t0);
                failCount++;
              case 30:
                _context4.next = 11;
                break;
              case 32:
                _context4.next = 37;
                break;
              case 34:
                _context4.prev = 34;
                _context4.t1 = _context4["catch"](9);
                _iterator.e(_context4.t1);
              case 37:
                _context4.prev = 37;
                _iterator.f();
                return _context4.finish(37);
              case 40:
                uni.hideLoading();

                // 显示预约结果
                message = successCount > 0 ? failCount > 0 ? "\u6210\u529F\u9884\u7EA6".concat(successCount, "\u4E2A\u8BFE\u7A0B\uFF0C").concat(failCount, "\u4E2A\u5931\u8D25") : "\u5DF2\u6210\u529F\u9884\u7EA6".concat(successCount, "\u4E2A\u8BFE\u7A0B") : '预约失败，请稍后重试';
                uni.showToast({
                  title: message,
                  icon: successCount > 0 ? 'success' : 'none',
                  duration: 2000
                });

                // 如果全部预约成功，跳转到预约列表页
                if (successCount > 0 && failCount === 0) {
                  setTimeout(function () {
                    uni.navigateTo({
                      url: '/pages/user/booking'
                    });
                  }, 2000);
                }

                // 刷新列表
                setTimeout(function () {
                  _this5.refreshList();
                }, 2500);
              case 45:
              case "end":
                return _context4.stop();
            }
          }
        }, _callee4, null, [[9, 34, 37, 40], [13, 26]]);
      }))();
    },
    // 提交预约
    submitBooking: function submitBooking(courseId) {
      var _arguments2 = arguments,
        _this6 = this;
      return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee5() {
        var showLoading, userId, userName, phoneNumber, courseRes, course, conflictRes, res;
        return _regenerator.default.wrap(function _callee5$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
                showLoading = _arguments2.length > 1 && _arguments2[1] !== undefined ? _arguments2[1] : true;
                if (showLoading) {
                  uni.showLoading({
                    title: '预约中...'
                  });
                }
                _context5.prev = 2;
                // 确保有有效的用户ID和信息
                if (!_this6.userInfo) {
                  _this6.getUserInfo();
                }
                if (_this6.userInfo) {
                  _context5.next = 8;
                  break;
                }
                if (showLoading) uni.hideLoading();
                uni.showToast({
                  title: '请先登录',
                  icon: 'none'
                });
                return _context5.abrupt("return", null);
              case 8:
                userId = _this6.userInfo.userId || _this6.userInfo._id || _this6.userInfo.uid || _this6.userInfo.userInfo && _this6.userInfo.userInfo._id || _this6.userInfo.userInfo && _this6.userInfo.userInfo.uid;
                if (userId) {
                  _context5.next = 13;
                  break;
                }
                if (showLoading) uni.hideLoading();
                uni.showToast({
                  title: '用户信息不完整，请重新登录',
                  icon: 'none'
                });
                return _context5.abrupt("return", null);
              case 13:
                // 获取用户名称
                userName = _this6.userInfo.nickName || _this6.userInfo.nickname || _this6.userInfo.username || _this6.userInfo.userInfo && _this6.userInfo.userInfo.nickname || '微信用户'; // 获取手机号
                phoneNumber = _this6.userInfo.phoneNumber || _this6.userInfo.mobile || _this6.userInfo.userInfo && _this6.userInfo.userInfo.mobile || '';
                console.log('提交预约数据：用户ID:', userId, '课程ID:', courseId);
                console.log('用户名称:', userName, '手机号:', phoneNumber || '(未提供)');

                // 检查课程冲突
                _context5.prev = 17;
                _context5.next = 20;
                return uniCloud.callFunction({
                  name: 'getCourseDetail',
                  data: {
                    courseId: courseId
                  }
                });
              case 20:
                courseRes = _context5.sent;
                if (!(courseRes.result && courseRes.result.data)) {
                  _context5.next = 29;
                  break;
                }
                course = courseRes.result.data; // 检查课程冲突
                _context5.next = 25;
                return _this6.checkCourseConflict(course, userId);
              case 25:
                conflictRes = _context5.sent;
                if (!(conflictRes && conflictRes.hasConflict)) {
                  _context5.next = 29;
                  break;
                }
                // 有冲突，显示冲突对话框
                if (showLoading) uni.hideLoading();
                return _context5.abrupt("return", _this6.showConflictDialog(conflictRes, course, userId));
              case 29:
                _context5.next = 34;
                break;
              case 31:
                _context5.prev = 31;
                _context5.t0 = _context5["catch"](17);
                console.error('检查课程冲突失败:', _context5.t0);
                // 冲突检查失败，继续预约流程
              case 34:
                _context5.next = 36;
                return uniCloud.callFunction({
                  name: 'bookCourse',
                  data: {
                    userId: userId,
                    courseId: courseId,
                    userName: userName,
                    phoneNumber: phoneNumber,
                    remark: ''
                  }
                });
              case 36:
                res = _context5.sent;
                console.log('预约结果详情:', JSON.stringify(res.result));
                if (showLoading) uni.hideLoading();
                if (!(res.result && res.result.success)) {
                  _context5.next = 48;
                  break;
                }
                console.log('预约成功:', res.result);
                if (showLoading) {
                  uni.showToast({
                    title: '预约成功',
                    icon: 'success'
                  });
                }

                // 发送预约成功事件，用于其他页面更新
                uni.$emit('booking:success', {
                  courseId: courseId,
                  userId: userId
                });

                // 如果预约成功，从购物车中移除
                if (_this6.currentBookingCourseId) {
                  _this6.removeFromCartAfterBooking(_this6.currentBookingCourseId);
                }

                // 预约成功后显示支付时间限制提示
                if (showLoading) {
                  setTimeout(function () {
                    uni.showModal({
                      title: '支付提醒',
                      content: '您需要在7天内完成支付，否则预约将被自动取消',
                      showCancel: false,
                      success: function success() {
                        // 预约成功后，跳转到预约详情页
                        if (res.result.data && res.result.data.bookingId) {
                          uni.navigateTo({
                            url: '/pages/user/booking-detail?id=' + res.result.data.bookingId
                          });
                        } else {
                          // 跳转到预约列表页
                          uni.navigateTo({
                            url: '/pages/user/booking'
                          });
                        }
                      }
                    });
                  }, 1500);
                }
                return _context5.abrupt("return", res.result);
              case 48:
                console.error('预约失败:', res.result);
                if (showLoading) {
                  uni.showToast({
                    title: res.result && res.result.message ? res.result.message : '预约失败',
                    icon: 'none'
                  });
                }
                return _context5.abrupt("return", res.result);
              case 51:
                _context5.next = 59;
                break;
              case 53:
                _context5.prev = 53;
                _context5.t1 = _context5["catch"](2);
                if (showLoading) uni.hideLoading();
                console.error('预约课程过程中发生异常:', _context5.t1);
                if (showLoading) {
                  uni.showToast({
                    title: '预约失败，请稍后重试',
                    icon: 'none'
                  });
                }
                return _context5.abrupt("return", null);
              case 59:
              case "end":
                return _context5.stop();
            }
          }
        }, _callee5, null, [[2, 53], [17, 31]]);
      }))();
    },
    // 检查课程冲突
    checkCourseConflict: function checkCourseConflict(course, userId) {
      return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee6() {
        var bookedCoursesRes, conflictResult, courseCalendarUtils, handleCourseConflictCheck, bookedCourses, _iterator2, _step2, booking, db, scheduleRes, scheduleData, courseIds, courseRes, courseMap, _iterator3, _step3, schedule, existingCourse, validTimeSlots, firstSlot, firstStart, firstEnd;
        return _regenerator.default.wrap(function _callee6$(_context6) {
          while (1) {
            switch (_context6.prev = _context6.next) {
              case 0:
                _context6.prev = 0;
                console.log('开始检查课程冲突，课程:', course.title || course.courseTitle || '未命名课程', '用户ID:', userId);

                // 1. 从预约表获取用户已确认的预约
                _context6.next = 4;
                return uniCloud.callFunction({
                  name: 'getUserBookings',
                  data: {
                    userId: userId,
                    status: 'confirmed' // 只检查已确认的预约
                  }
                });
              case 4:
                bookedCoursesRes = _context6.sent;
                console.log('获取用户预约结果:', bookedCoursesRes.result);
                conflictResult = {
                  hasConflict: false,
                  conflictCourses: []
                };
                courseCalendarUtils = __webpack_require__(/*! @/utils/courseCalendar.js */ 126); // 定义一个处理冲突检测的内部函数
                handleCourseConflictCheck = function handleCourseConflictCheck(existingCourse) {
                  // 忽略无效课程
                  if (!existingCourse) return;
                  console.log('检查课程冲突 - 已预约课程:', existingCourse.title || existingCourse.courseTitle || '未命名课程');

                  // 使用courseCalendar工具检测冲突
                  var result = courseCalendarUtils.checkCoursesConflict(course, existingCourse);
                  if (result.hasConflict) {
                    console.log('检测到课程冲突!', result);
                    conflictResult.hasConflict = true;
                    conflictResult.conflictCourses.push({
                      course: existingCourse,
                      conflictDates: result.conflictDates
                    });
                  }
                }; // 2. 检查从预约表获取的课程冲突
                if (bookedCoursesRes.result && bookedCoursesRes.result.data) {
                  bookedCourses = bookedCoursesRes.result.data; // 遍历已预约的课程，检查冲突
                  _iterator2 = _createForOfIteratorHelper(bookedCourses);
                  try {
                    for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {
                      booking = _step2.value;
                      // 检查booking.courseInfo
                      if (booking.courseInfo) {
                        handleCourseConflictCheck(booking.courseInfo);
                      }
                    }
                  } catch (err) {
                    _iterator2.e(err);
                  } finally {
                    _iterator2.f();
                  }
                }

                // 3. 如果没有找到冲突，尝试从course_schedule表中查询
                if (conflictResult.hasConflict) {
                  _context6.next = 32;
                  break;
                }
                console.log('从预约记录中未检测到冲突，准备从course_schedule表查询');
                _context6.prev = 12;
                // 从课程日程表中获取用户课程
                db = uniCloud.database();
                _context6.next = 16;
                return db.collection('course_schedule').where({
                  students: db.command.all([userId])
                }).get();
              case 16:
                scheduleRes = _context6.sent;
                console.log('获取课程日程表数据:', scheduleRes);
                if (!(scheduleRes.data && scheduleRes.data.length > 0)) {
                  _context6.next = 27;
                  break;
                }
                scheduleData = scheduleRes.data; // 获取所有相关课程ID
                courseIds = scheduleData.map(function (schedule) {
                  return schedule.courseId;
                }).filter(function (id) {
                  return id;
                });
                if (!(courseIds.length > 0)) {
                  _context6.next = 27;
                  break;
                }
                _context6.next = 24;
                return db.collection('course').where({
                  _id: db.command.in(courseIds)
                }).get();
              case 24:
                courseRes = _context6.sent;
                console.log('获取课程详情数据:', courseRes);
                if (courseRes.data && courseRes.data.length > 0) {
                  courseMap = {};
                  courseRes.data.forEach(function (course) {
                    courseMap[course._id] = course;
                  });

                  // 检查课程日程表中的每个课程
                  _iterator3 = _createForOfIteratorHelper(scheduleData);
                  try {
                    for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {
                      schedule = _step3.value;
                      if (schedule.courseId && courseMap[schedule.courseId]) {
                        existingCourse = courseMap[schedule.courseId]; // 检查timeSlots是否有冲突
                        if (schedule.timeSlots && schedule.timeSlots.length > 0) {
                          // 从timeSlots提取上课时间范围
                          validTimeSlots = schedule.timeSlots.filter(function (slot) {
                            return slot.status !== 'cancelled';
                          });
                          if (validTimeSlots.length > 0) {
                            // 为course添加必要的时间字段
                            existingCourse.startDate = new Date(Math.min.apply(Math, (0, _toConsumableArray2.default)(validTimeSlots.map(function (s) {
                              return new Date(s.start).getTime();
                            }))));
                            existingCourse.endDate = new Date(Math.max.apply(Math, (0, _toConsumableArray2.default)(validTimeSlots.map(function (s) {
                              return new Date(s.end).getTime();
                            }))));

                            // 从第一个时间槽提取上课时间
                            firstSlot = validTimeSlots[0];
                            firstStart = new Date(firstSlot.start);
                            firstEnd = new Date(firstSlot.end);
                            existingCourse.startTime = "".concat(firstStart.getHours().toString().padStart(2, '0'), ":").concat(firstStart.getMinutes().toString().padStart(2, '0'));
                            existingCourse.endTime = "".concat(firstEnd.getHours().toString().padStart(2, '0'), ":").concat(firstEnd.getMinutes().toString().padStart(2, '0'));

                            // 提取classTime (星期几)
                            existingCourse.classTime = validTimeSlots.map(function (slot) {
                              var date = new Date(slot.start);
                              var weekday = ['周日', '周一', '周二', '周三', '周四', '周五', '周六'][date.getDay()];
                              return weekday;
                            }).filter(function (v, i, a) {
                              return a.indexOf(v) === i;
                            }); // 去重

                            console.log('从course_schedule提取的课程信息:', existingCourse);

                            // 检查冲突
                            handleCourseConflictCheck(existingCourse);
                          }
                        }
                      }
                    }
                  } catch (err) {
                    _iterator3.e(err);
                  } finally {
                    _iterator3.f();
                  }
                }
              case 27:
                _context6.next = 32;
                break;
              case 29:
                _context6.prev = 29;
                _context6.t0 = _context6["catch"](12);
                console.error('获取课程日程表失败:', _context6.t0);
              case 32:
                return _context6.abrupt("return", conflictResult);
              case 35:
                _context6.prev = 35;
                _context6.t1 = _context6["catch"](0);
                console.error('检查课程冲突出错:', _context6.t1);
                return _context6.abrupt("return", {
                  hasConflict: false
                });
              case 39:
              case "end":
                return _context6.stop();
            }
          }
        }, _callee6, null, [[0, 35], [12, 29]]);
      }))();
    },
    // 显示课程冲突提示对话框
    showConflictDialog: function showConflictDialog(conflictResult, course, userId) {
      var _this7 = this;
      // 构建冲突信息文本
      var courseCalendarUtils = __webpack_require__(/*! @/utils/courseCalendar.js */ 126);
      var conflictMessage = '您已预约的课程与此课程时间冲突：\n\n';
      conflictResult.conflictCourses.forEach(function (item, index) {
        var conflictCourse = item.course;
        conflictMessage += "".concat(index + 1, ". ").concat(conflictCourse.title || conflictCourse.courseTitle, "\n");
        conflictMessage += "   \u65F6\u95F4\uFF1A".concat(conflictCourse.startTime, "-").concat(conflictCourse.endTime, "\n");

        // 添加冲突日期
        if (item.conflictDates && item.conflictDates.length > 0) {
          var formattedDates = item.conflictDates.map(function (date) {
            return courseCalendarUtils.formatDate(date);
          });
          conflictMessage += "   \u51B2\u7A81\u65E5\u671F\uFF1A".concat(formattedDates.join('、'), "\n");
        }
        conflictMessage += '\n';
      });
      conflictMessage += '确定要继续预约吗？';

      // 返回一个Promise
      return new Promise(function (resolve) {
        // 显示确认对话框
        uni.showModal({
          title: '课程时间冲突',
          content: conflictMessage,
          confirmText: '继续预约',
          cancelText: '取消',
          success: function () {
            var _success = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee7(res) {
              var result;
              return _regenerator.default.wrap(function _callee7$(_context7) {
                while (1) {
                  switch (_context7.prev = _context7.next) {
                    case 0:
                      if (!res.confirm) {
                        _context7.next = 7;
                        break;
                      }
                      _context7.next = 3;
                      return _this7.proceedWithBooking(course.id || course._id, userId);
                    case 3:
                      result = _context7.sent;
                      resolve(result);
                      _context7.next = 8;
                      break;
                    case 7:
                      resolve({
                        success: false,
                        message: '用户取消预约'
                      });
                    case 8:
                    case "end":
                      return _context7.stop();
                  }
                }
              }, _callee7);
            }));
            function success(_x) {
              return _success.apply(this, arguments);
            }
            return success;
          }()
        });
      });
    },
    // 继续预约流程
    proceedWithBooking: function proceedWithBooking(courseId, userId) {
      var _this8 = this;
      return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee8() {
        var userName, phoneNumber, res;
        return _regenerator.default.wrap(function _callee8$(_context8) {
          while (1) {
            switch (_context8.prev = _context8.next) {
              case 0:
                // 获取用户名称
                userName = _this8.userInfo.nickName || _this8.userInfo.nickname || _this8.userInfo.username || _this8.userInfo.userInfo && _this8.userInfo.userInfo.nickname || '微信用户'; // 获取手机号
                phoneNumber = _this8.userInfo.phoneNumber || _this8.userInfo.mobile || _this8.userInfo.userInfo && _this8.userInfo.userInfo.mobile || '';
                uni.showLoading({
                  title: '预约中...'
                });
                _context8.prev = 3;
                _context8.next = 6;
                return uniCloud.callFunction({
                  name: 'bookCourse',
                  data: {
                    userId: userId,
                    courseId: courseId,
                    userName: userName,
                    phoneNumber: phoneNumber,
                    remark: ''
                  }
                });
              case 6:
                res = _context8.sent;
                uni.hideLoading();
                if (!(res.result && res.result.success)) {
                  _context8.next = 15;
                  break;
                }
                uni.showToast({
                  title: '预约成功',
                  icon: 'success'
                });

                // 发送预约成功事件
                uni.$emit('booking:success', {
                  courseId: courseId,
                  userId: userId
                });

                // 如果预约成功，从购物车中移除
                if (_this8.currentBookingCourseId) {
                  _this8.removeFromCartAfterBooking(_this8.currentBookingCourseId);
                }
                return _context8.abrupt("return", res.result);
              case 15:
                uni.showToast({
                  title: res.result && res.result.message ? res.result.message : '预约失败',
                  icon: 'none'
                });
                return _context8.abrupt("return", res.result);
              case 17:
                _context8.next = 25;
                break;
              case 19:
                _context8.prev = 19;
                _context8.t0 = _context8["catch"](3);
                uni.hideLoading();
                console.error('预约课程过程中发生异常:', _context8.t0);
                uni.showToast({
                  title: '预约失败，请稍后重试',
                  icon: 'none'
                });
                return _context8.abrupt("return", {
                  success: false,
                  message: '预约过程发生异常'
                });
              case 25:
              case "end":
                return _context8.stop();
            }
          }
        }, _callee8, null, [[3, 19]]);
      }))();
    },
    // 批量删除
    batchDelete: function batchDelete() {
      var _this9 = this;
      return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee11() {
        return _regenerator.default.wrap(function _callee11$(_context11) {
          while (1) {
            switch (_context11.prev = _context11.next) {
              case 0:
                _context11.prev = 0;
                if (!(_this9.isManageMode && _this9.selectedCount === 0)) {
                  _context11.next = 4;
                  break;
                }
                uni.showToast({
                  title: '请选择要删除的项目',
                  icon: 'none'
                });
                return _context11.abrupt("return");
              case 4:
                // 使用uni.showModal代替this.$helper.showModal
                uni.showModal({
                  title: '确认删除',
                  content: '确定要删除选中的项目吗？',
                  success: function () {
                    var _success2 = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee10(result) {
                      var deleteItems, promises;
                      return _regenerator.default.wrap(function _callee10$(_context10) {
                        while (1) {
                          switch (_context10.prev = _context10.next) {
                            case 0:
                              if (!result.confirm) {
                                _context10.next = 23;
                                break;
                              }
                              uni.showLoading({
                                title: '处理中'
                              });
                              deleteItems = _this9.isManageMode ? _this9.favoriteList.filter(function (item) {
                                return item.selected;
                              }) : [_this9.favoriteList.find(function (item) {
                                return item._id === _this9.currentBookingCourseId;
                              })];
                              if (!(!deleteItems.length || !deleteItems[0])) {
                                _context10.next = 7;
                                break;
                              }
                              uni.hideLoading();
                              uni.showToast({
                                title: '没有找到要删除的项目',
                                icon: 'none'
                              });
                              return _context10.abrupt("return");
                            case 7:
                              promises = deleteItems.map( /*#__PURE__*/function () {
                                var _ref = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee9(item) {
                                  var favoriteId;
                                  return _regenerator.default.wrap(function _callee9$(_context9) {
                                    while (1) {
                                      switch (_context9.prev = _context9.next) {
                                        case 0:
                                          _context9.prev = 0;
                                          if (!(!item || !item._id)) {
                                            _context9.next = 4;
                                            break;
                                          }
                                          console.error('删除项目无效:', item);
                                          return _context9.abrupt("return", Promise.reject(new Error('无效的删除项目')));
                                        case 4:
                                          // 直接传递ID字符串
                                          favoriteId = item._id;
                                          console.log('准备删除收藏，ID:', favoriteId);
                                          _context9.next = 8;
                                          return _this9.$api.user.removeFavorite(favoriteId);
                                        case 8:
                                          return _context9.abrupt("return", Promise.resolve());
                                        case 11:
                                          _context9.prev = 11;
                                          _context9.t0 = _context9["catch"](0);
                                          console.error('删除失败:', _context9.t0, 'item:', item);
                                          return _context9.abrupt("return", Promise.reject(_context9.t0));
                                        case 15:
                                        case "end":
                                          return _context9.stop();
                                      }
                                    }
                                  }, _callee9, null, [[0, 11]]);
                                }));
                                return function (_x3) {
                                  return _ref.apply(this, arguments);
                                };
                              }());
                              _context10.prev = 8;
                              _context10.next = 11;
                              return Promise.allSettled(promises);
                            case 11:
                              // 更新列表
                              _this9.favoriteList = _this9.favoriteList.filter(function (item) {
                                return !deleteItems.some(function (deleteItem) {
                                  return deleteItem._id === item._id;
                                });
                              });
                              uni.showToast({
                                title: '删除成功',
                                icon: 'success'
                              });

                              // 退出管理模式
                              if (_this9.isManageMode) {
                                _this9.toggleManageMode();
                              }
                              _context10.next = 20;
                              break;
                            case 16:
                              _context10.prev = 16;
                              _context10.t0 = _context10["catch"](8);
                              console.error('执行删除操作失败:', _context10.t0);
                              uni.showToast({
                                title: '删除失败',
                                icon: 'none'
                              });
                            case 20:
                              _context10.prev = 20;
                              uni.hideLoading();
                              return _context10.finish(20);
                            case 23:
                            case "end":
                              return _context10.stop();
                          }
                        }
                      }, _callee10, null, [[8, 16, 20, 23]]);
                    }));
                    function success(_x2) {
                      return _success2.apply(this, arguments);
                    }
                    return success;
                  }()
                });
                _context11.next = 12;
                break;
              case 7:
                _context11.prev = 7;
                _context11.t0 = _context11["catch"](0);
                console.error('批量删除失败:', _context11.t0);
                uni.hideLoading();
                uni.showToast({
                  title: '删除失败',
                  icon: 'none'
                });
              case 12:
              case "end":
                return _context11.stop();
            }
          }
        }, _callee11, null, [[0, 7]]);
      }))();
    },
    // 获取默认图片
    getDefaultImage: function getDefaultImage(itemType) {
      switch (itemType) {
        case 'course':
          return '/static/images/default-course.jpg';
        case 'lecture':
          return '/static/images/default-lecture.jpg';
        case 'teacher':
          return '/static/images/default-teacher.jpg';
        default:
          return '/static/images/default.jpg';
      }
    },
    // 加载更多
    loadMore: function loadMore() {
      if (this.hasMore && !this.loading) {
        this.page++;
        this.getFavoriteList();
      }
    },
    // 处理点击事件
    handleClick: function handleClick(index) {
      // 如果当前项目处于滑动状态，先关闭
      if (this.favoriteList[index].swipeActive) {
        this.$set(this.favoriteList[index], 'swipeActive', false);
        return;
      }

      // 关闭所有已打开的滑动项
      this.closeAllSwipeItems();

      // 跳转到课程详情
      var item = this.favoriteList[index];
      if (item.itemId && item.itemType === 'course') {
        uni.navigateTo({
          url: "/pages/course/detail?id=".concat(item.itemId)
        });
      } else if (item.itemType === 'teacher' && item.itemId) {
        uni.navigateTo({
          url: "/pages/teacher/detail?id=".concat(item.itemId)
        });
      }
    },
    // 关闭所有已打开的滑动项
    closeAllSwipeItems: function closeAllSwipeItems() {
      var _this10 = this;
      this.favoriteList.forEach(function (item, i) {
        if (item.swipeActive) {
          _this10.$set(_this10.favoriteList[i], 'swipeActive', false);
        }
      });
    },
    // 处理删除
    handleDelete: function handleDelete(index) {
      if (!this.favoriteList[index]) return;
      if (index < 0 || index >= this.favoriteList.length) {
        console.error('无效的索引:', index);
        return;
      }
      var item = this.favoriteList[index];
      if (!item) {
        console.error('索引对应的收藏项为空:', index);
        return;
      }
      console.log('删除收藏项, 索引:', index);
      this.cancelFavorite(index);
    },
    // 取消收藏
    cancelFavorite: function cancelFavorite(index) {
      var _this11 = this;
      return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee13() {
        var item;
        return _regenerator.default.wrap(function _callee13$(_context13) {
          while (1) {
            switch (_context13.prev = _context13.next) {
              case 0:
                item = _this11.favoriteList[index];
                if (item) {
                  _context13.next = 4;
                  break;
                }
                uni.showToast({
                  title: '收藏项不存在',
                  icon: 'none'
                });
                return _context13.abrupt("return");
              case 4:
                if (item._id) {
                  _context13.next = 7;
                  break;
                }
                uni.showToast({
                  title: '收藏ID不存在',
                  icon: 'none'
                });
                return _context13.abrupt("return");
              case 7:
                uni.showModal({
                  title: '提示',
                  content: '确定要取消收藏吗？',
                  success: function () {
                    var _success3 = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee12(res) {
                      var favoriteId, result;
                      return _regenerator.default.wrap(function _callee12$(_context12) {
                        while (1) {
                          switch (_context12.prev = _context12.next) {
                            case 0:
                              if (!res.confirm) {
                                _context12.next = 18;
                                break;
                              }
                              _context12.prev = 1;
                              uni.showLoading({
                                title: '处理中'
                              });
                              favoriteId = item._id;
                              console.log('准备删除收藏，ID:', favoriteId);

                              // 直接传递ID字符串，而不是包含ID的对象
                              _context12.next = 7;
                              return _this11.$api.user.removeFavorite(favoriteId);
                            case 7:
                              result = _context12.sent;
                              if (result && result.code === 0) {
                                // 从列表中移除
                                _this11.favoriteList.splice(index, 1);
                                uni.showToast({
                                  title: '已取消收藏',
                                  icon: 'success'
                                });
                              } else {
                                uni.showToast({
                                  title: '操作失败',
                                  icon: 'none'
                                });
                              }
                              _context12.next = 15;
                              break;
                            case 11:
                              _context12.prev = 11;
                              _context12.t0 = _context12["catch"](1);
                              console.error('取消收藏失败:', _context12.t0);
                              uni.showToast({
                                title: '操作失败',
                                icon: 'none'
                              });
                            case 15:
                              _context12.prev = 15;
                              uni.hideLoading();
                              return _context12.finish(15);
                            case 18:
                            case "end":
                              return _context12.stop();
                          }
                        }
                      }, _callee12, null, [[1, 11, 15, 18]]);
                    }));
                    function success(_x4) {
                      return _success3.apply(this, arguments);
                    }
                    return success;
                  }()
                });
              case 8:
              case "end":
                return _context13.stop();
            }
          }
        }, _callee13);
      }))();
    },
    // 获取项目类型名称
    getItemTypeName: function getItemTypeName(type) {
      var typeMap = {
        'course': '课程',
        'lecture': '讲座',
        'teacher': '教师',
        'news': '资讯'
      };
      return typeMap[type] || '未知';
    },
    // 格式化日期
    formatDate: function formatDate(timestamp) {
      if (!timestamp) return '';
      var date = new Date(timestamp);
      return "".concat(date.getFullYear(), "-").concat((date.getMonth() + 1).toString().padStart(2, '0'), "-").concat(date.getDate().toString().padStart(2, '0'));
    },
    // 处理图片加载错误
    handleImageError: function handleImageError(index) {
      if (index < 0 || index >= this.favoriteList.length) {
        console.error('无效的索引:', index);
        return;
      }
      var item = this.favoriteList[index];
      if (!item) {
        console.error('索引对应的收藏项为空:', index);
        return;
      }
      console.log('图片加载错误, 索引:', index);
      item.itemCover = this.getDefaultImage(item.itemType);
    },
    // 预约成功后从购物车中移除
    removeFromCartAfterBooking: function removeFromCartAfterBooking(favoriteId) {
      var _arguments3 = arguments,
        _this12 = this;
      return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee14() {
        var showToast, result, index;
        return _regenerator.default.wrap(function _callee14$(_context14) {
          while (1) {
            switch (_context14.prev = _context14.next) {
              case 0:
                showToast = _arguments3.length > 1 && _arguments3[1] !== undefined ? _arguments3[1] : true;
                if (favoriteId) {
                  _context14.next = 4;
                  break;
                }
                console.error('移除购物车项失败: 缺少ID');
                return _context14.abrupt("return");
              case 4:
                _context14.prev = 4;
                console.log('从购物车移除已预约课程，ID:', favoriteId);

                // 直接传递ID字符串，而不是包含ID的对象
                _context14.next = 8;
                return _this12.$api.user.removeFavorite(favoriteId);
              case 8:
                result = _context14.sent;
                if (!(result && result.code === 0)) {
                  _context14.next = 16;
                  break;
                }
                // 从列表中移除
                index = _this12.favoriteList.findIndex(function (item) {
                  return item._id === favoriteId;
                });
                if (index !== -1) {
                  _this12.favoriteList.splice(index, 1);
                }
                if (showToast) {
                  uni.showToast({
                    title: '已从购物车移除',
                    icon: 'success'
                  });
                }

                // 清除当前处理的ID
                _this12.currentBookingCourseId = null;
                _this12.currentSelectedCourseIds = [];
                return _context14.abrupt("return", true);
              case 16:
                return _context14.abrupt("return", false);
              case 19:
                _context14.prev = 19;
                _context14.t0 = _context14["catch"](4);
                console.error('移除购物车项失败:', _context14.t0);
                return _context14.abrupt("return", false);
              case 23:
              case "end":
                return _context14.stop();
            }
          }
        }, _callee14, null, [[4, 19]]);
      }))();
    },
    // 处理页面点击事件
    onPageClick: function onPageClick() {
      // 关闭所有已打开的滑动项
      this.closeAllSwipeItems();
    }
  }
};
exports.default = _default;
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./node_modules/@dcloudio/uni-mp-weixin/dist/index.js */ 2)["default"], __webpack_require__(/*! ./node_modules/@dcloudio/vue-cli-plugin-uni/packages/uni-cloud/dist/index.js */ 26)["uniCloud"]))

/***/ }),

/***/ 127:
/*!**********************************************************************************************************************************!*\
  !*** C:/Users/liuxingyu/Desktop/TurboTrainning-main/yueke/Siwei_chuzhong/pages/cart/index.vue?vue&type=style&index=0&lang=scss& ***!
  \**********************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_dist_cjs_js_ref_8_oneOf_1_1_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_stylePostLoader_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_2_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_3_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_sass_loader_dist_cjs_js_ref_8_oneOf_1_4_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_5_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!./node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!./node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-2!./node_modules/postcss-loader/src??ref--8-oneOf-1-3!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-5!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&lang=scss& */ 128);
/* harmony import */ var _D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_dist_cjs_js_ref_8_oneOf_1_1_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_stylePostLoader_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_2_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_3_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_sass_loader_dist_cjs_js_ref_8_oneOf_1_4_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_5_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_dist_cjs_js_ref_8_oneOf_1_1_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_stylePostLoader_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_2_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_3_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_sass_loader_dist_cjs_js_ref_8_oneOf_1_4_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_5_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0__);
/* harmony reexport (unknown) */ for(var __WEBPACK_IMPORT_KEY__ in _D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_dist_cjs_js_ref_8_oneOf_1_1_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_stylePostLoader_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_2_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_3_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_sass_loader_dist_cjs_js_ref_8_oneOf_1_4_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_5_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0__) if(["default"].indexOf(__WEBPACK_IMPORT_KEY__) < 0) (function(key) { __webpack_require__.d(__webpack_exports__, key, function() { return _D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_dist_cjs_js_ref_8_oneOf_1_1_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_stylePostLoader_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_2_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_3_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_sass_loader_dist_cjs_js_ref_8_oneOf_1_4_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_5_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0__[key]; }) }(__WEBPACK_IMPORT_KEY__));
 /* harmony default export */ __webpack_exports__["default"] = (_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_dist_cjs_js_ref_8_oneOf_1_1_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_stylePostLoader_js_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_2_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_3_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_sass_loader_dist_cjs_js_ref_8_oneOf_1_4_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_5_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_HBuilderX_4_55_2025030718_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0___default.a); 

/***/ }),

/***/ 128:
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!./node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-2!./node_modules/postcss-loader/src??ref--8-oneOf-1-3!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-5!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!C:/Users/liuxingyu/Desktop/TurboTrainning-main/yueke/Siwei_chuzhong/pages/cart/index.vue?vue&type=style&index=0&lang=scss& ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// extracted by mini-css-extract-plugin
    if(false) { var cssReload; }
  

/***/ })

},[[120,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/cart/index.js.map
<view class="container"><view class="header"><text class="title">课程教师关联管理</text></view><view class="form-group"><text class="label">操作模式：</text><view class="radio-group"><radio-group data-event-opts="{{[['change',[['onModeChange',['$event']]]]]}}" bindchange="__e"><label class="radio-item"><radio value="batch" checked="{{mode==='batch'}}"></radio><text>批量更新</text></label><label class="radio-item"><radio value="single" checked="{{mode==='single'}}"></radio><text>单个更新</text></label></radio-group></view></view><block wx:if="{{mode==='single'}}"><block><view class="form-group"><text class="label">选择课程：</text><picker value="{{courseIndex}}" range="{{courseOptions}}" range-key="label" data-event-opts="{{[['change',[['onCourseChange',['$event']]]]]}}" bindchange="__e"><view class="picker-item"><block wx:if="{{selectedCourse}}"><text>{{selectedCourse.label}}</text></block><block wx:else><text class="placeholder">请选择课程</text></block></view></picker></view><view class="form-group"><text class="label">选择教师：</text><picker value="{{teacherIndex}}" range="{{teacherOptions}}" range-key="label" data-event-opts="{{[['change',[['onTeacherChange',['$event']]]]]}}" bindchange="__e"><view class="picker-item"><block wx:if="{{selectedTeacher}}"><text>{{selectedTeacher.label}}</text></block><block wx:else><text class="placeholder">请选择教师</text></block></view></picker></view><view class="form-group"><text class="label">当前关联信息：</text><view class="info-card"><block wx:if="{{selectedCourse}}"><view class="info-item"><text class="info-label">课程：</text><text class="info-value">{{selectedCourse.label}}</text></view></block><block wx:if="{{selectedCourse&&selectedCourse.teacherId}}"><view class="info-item"><text class="info-label">当前教师ID：</text><text class="info-value">{{selectedCourse.teacherId||'未设置'}}</text></view></block><block wx:if="{{selectedCourse&&selectedCourse.teacherName}}"><view class="info-item"><text class="info-label">当前教师名称：</text><text class="info-value">{{selectedCourse.teacherName||'未设置'}}</text></view></block><block wx:if="{{selectedTeacher}}"><view class="info-item"><text class="info-label">将要关联的教师：</text><text class="info-value">{{selectedTeacher.label}}</text></view></block></view></view><button class="submit-btn" disabled="{{!selectedCourse||!selectedTeacher}}" data-event-opts="{{[['tap',[['updateSingleCourse',['$event']]]]]}}" bindtap="__e">更新关联关系</button></block></block><block wx:if="{{mode==='batch'}}"><block><view class="form-group"><text class="tips">批量更新会自动查找所有有教师姓名但没有设置教师ID的课程，尝试匹配并更新。</text></view><view class="info-card"><view class="info-item"><text class="info-label">待更新课程数：</text><text class="info-value">{{pendingCoursesCount}}</text></view><view class="info-item"><text class="info-label">教师总数：</text><text class="info-value">{{$root.g0}}</text></view></view><button data-event-opts="{{[['tap',[['runBatchUpdate',['$event']]]]]}}" class="submit-btn" bindtap="__e">执行批量更新</button></block></block><block wx:if="{{updateResult}}"><view class="result-section"><view class="section-title">更新结果</view><view class="result-card"><view class="result-item"><text class="result-label">总数：</text><text class="result-value">{{updateResult.total||0}}</text></view><view class="result-item"><text class="result-label">成功：</text><text class="result-value success">{{updateResult.success||0}}</text></view><block wx:if="{{updateResult.failed}}"><view class="result-item"><text class="result-label">失败：</text><text class="result-value failed">{{updateResult.failed||0}}</text></view></block><block wx:if="{{updateResult.message}}"><view class="result-message"><text>{{updateResult.message}}</text></view></block></view></view></block><block wx:if="{{$root.g1}}"><view class="result-details"><view class="section-title">详细结果</view><view class="result-list"><block wx:for="{{updateResult.results}}" wx:for-item="item" wx:for-index="index" wx:key="index"><view class="{{['result-list-item',(item.success)?'success':'',(!item.success)?'failed':'']}}"><view class="result-list-title">{{item.title||'未知课程'}}</view><view class="result-list-detail"><text>{{"教师: "+item.teacherName}}</text><block wx:if="{{item.success}}"><text>{{'→ ID: '+item.teacherId}}</text></block><block wx:else><text class="error-text">{{'→ '+item.error}}</text></block></view></view></block></view></view></block></view>
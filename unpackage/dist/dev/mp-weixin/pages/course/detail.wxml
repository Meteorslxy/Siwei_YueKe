<view class="detail-container"><view class="fixed-favorite-wrapper" style="{{'top:'+(statusBarHeight+'px')+';'}}"><favorite-button class="vue-ref" vue-id="740a642c-1" itemId="{{courseId}}" itemType="course" itemTitle="{{courseInfo.title}}" itemCover="{{courseInfo.image||courseInfo.coverImage||'/static/images/course-default.jpg'}}" data-ref="favoriteBtn" data-event-opts="{{[['^favoriteChange',[['onFavoriteChange']]],['^statusBarHeight',[['onStatusBarHeight']]]]}}" bind:favoriteChange="__e" bind:statusBarHeight="__e" bind:__l="__l"></favorite-button></view><view class="course-header"><image class="course-cover" src="{{courseInfo.image||courseInfo.coverImage||'/static/images/course-default.jpg'}}" mode="aspectFill"></image><view class="course-overlay"></view><view class="course-title">{{courseInfo.title}}</view></view><block wx:if="{{false}}"><view class="debug-info" style="padding:10px;background-color:#f0f0f0;margin:10px;"><text style="display:block;">{{"课程ID: "+courseId}}</text><text style="display:block;">{{"用户ID: "+(userInfo?userInfo.userId:'未登录')}}</text><text style="display:block;">{{"预约状态: "+(hasBooked?'已预约':'未预约')}}</text><view style="display:flex;margin-top:5px;"><button data-event-opts="{{[['tap',[['toggleBookStatus',['$event']]]]]}}" style="flex:1;font-size:12px;padding:2px 5px;margin-right:5px;" bindtap="__e">切换预约状态</button><button data-event-opts="{{[['tap',[['forceRefreshStatus',['$event']]]]]}}" style="flex:1;font-size:12px;padding:2px 5px;" bindtap="__e">重新检查状态</button></view></view></block><view class="info-card"><view class="info-price"><text class="price-value">{{"¥"+$root.m0+".00"}}</text><text class="price-label">{{"/"+courseInfo.courseCount+"课时"}}</text></view><block wx:if="{{courseInfo.classFee||courseInfo.materialFee}}"><view class="info-item"><image class="item-icon" src="https://mp-a876f469-bab5-46b7-8863-2e7147900fdd.cdn.bspapp.com/icons/价格明细.png" mode="aspectFit"></image><text class="item-label">价格明细：</text><view class="item-value price-details"><text>{{"课时费：¥"+(courseInfo.classFee||0)+".00"}}</text><text>{{"材料费：¥"+(courseInfo.materialFee||0)+".00"}}</text></view></view></block><view class="info-item"><image class="item-icon" src="https://mp-a876f469-bab5-46b7-8863-2e7147900fdd.cdn.bspapp.com/icons/授课老师.png" mode="aspectFit"></image><text class="item-label">授课老师：</text><text class="item-value">{{courseInfo.teacherName}}</text><text class="teacher-title">{{courseInfo.teacherTitle}}</text></view><view class="info-item"><image class="item-icon" src="https://mp-a876f469-bab5-46b7-8863-2e7147900fdd.cdn.bspapp.com/icons/授课地点.png" mode="aspectFit"></image><text class="item-label">授课地点：</text><text class="item-value">{{courseInfo.location||courseInfo.schoolName||'未指定'}}</text></view><view class="info-item"><image class="item-icon" src="https://mp-a876f469-bab5-46b7-8863-2e7147900fdd.cdn.bspapp.com/icons/授课时间.png" mode="aspectFit"></image><text class="item-label">课程时间：</text><text class="item-value">{{$root.m1}}</text></view><view class="info-item"><image class="item-icon" src="https://mp-a876f469-bab5-46b7-8863-2e7147900fdd.cdn.bspapp.com/icons/招生人数.png" mode="aspectFit"></image><text class="item-label">招生人数：</text><text class="item-value">{{(courseInfo.courseCapacity||courseInfo.courseCount||courseInfo.capacity||20)+"人 (已报名"+(courseInfo.bookingCount||0)+"人，剩余"+$root.m2+"人)"}}</text></view></view><view class="course-detail"><view class="detail-title">课程详情</view><view class="detail-content"><rich-text nodes="{{courseInfo.description||'暂无课程详情'}}"></rich-text></view></view><view class="teacher-intro"><view class="detail-title">师资介绍</view><view data-event-opts="{{[['tap',[['navigateToTeacherDetail',['$event']]]]]}}" class="teacher-card" bindtap="__e"><image class="teacher-avatar" src="{{courseInfo.teacherAvatarUrl||courseInfo.teacherAvatar||'/static/images/teacher/default-avatar.png'}}" mode="aspectFill"></image><view class="teacher-info"><view class="teacher-header"><text class="teacher-name">{{courseInfo.teacherName}}</text><text class="teacher-title">{{courseInfo.teacherTitle}}</text></view><view class="teacher-desc">{{courseInfo.teacherDescription||courseInfo.teacherDesc||'暂无介绍'}}</view><block wx:if="{{false}}"><view style="margin-top:10rpx;"><button size="mini" type="default" data-event-opts="{{[['tap',[['debugTeacherInfo',['$event']]]]]}}" bindtap="__e">刷新师资信息</button></view></block></view></view></view><block wx:if="{{hasBooked}}"><view class="booking-info"><view class="detail-title">预约状态</view><view class="booking-status"><text class="status-icon iconfont icon-success"></text><text class="status-text">您已成功预约该课程</text></view><view class="booking-tips">可在<text data-event-opts="{{[['tap',[['navigateToBookingList',['$event']]]]]}}" class="tips-link" bindtap="__e">我的预约</text>中查看详情</view></view></block><view class="footer"><view data-event-opts="{{[['tap',[['contactTeacher',['$event']]]]]}}" class="contact-btn" bindtap="__e"><image class="btn-icon" src="https://mp-a876f469-bab5-46b7-8863-2e7147900fdd.cdn.bspapp.com/icons/联系老师.png" mode="aspectFit"></image><text>联系老师</text></view><block wx:if="{{!hasBooked}}"><button class="{{['book-btn',(isCourseFulled)?'disabled':'']}}" disabled="{{isCourseFulled}}" data-event-opts="{{[['tap',[['bookCourse',['$event']]]]]}}" bindtap="__e">{{isCourseFulled?'已约满':'立即预约'}}</button></block><block wx:else><button data-event-opts="{{[['tap',[['navigateToBookingList',['$event']]]]]}}" class="book-btn booked" bindtap="__e">查看预约</button></block></view></view>